(this["webpackJsonpscreen-record-react"]=this["webpackJsonpscreen-record-react"]||[]).push([[0],{137:function(e,t,n){e.exports=n(157)},143:function(e,t,n){},144:function(e,t,n){},146:function(e,t,n){},157:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(51),i=n.n(o),c=(n(142),n(143),n(9)),s=n(10),u=n(52),l=n(14),d=n(13),h=(n(144),{addToStorage:function(e,t){t=t.toString(),window.localStorage.setItem(e,t)},getFromStorage:function(e){return window.localStorage.getItem(e)},removeFromStorage:function(e){return window.localStorage.removeItem(e)}}),p="LOGIN_TOKEN";var m=n(12),f=n.n(m),g=n(26),v=window.location.origin+"/records-manager";function b(){return(b=Object(g.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(v+"/login/"+t,{method:"POST"});case 2:return n=e.sent,e.next=5,n.text();case 5:return r=e.sent,console.log(r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a.a.Component,n(146);function O(e){return E.apply(this,arguments)}function E(){return(E=Object(g.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,navigator.mediaDevices.getDisplayMedia(t.exportDiaplaMediaConstraints());case 4:if(n=e.sent,!t.grabMic){e.next=10;break}return e.next=8,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 8:r=e.sent,n.addTrack(r.getAudioTracks()[0]);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("Error: "+e.t0);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}var j={AUTO:{width:0,height:0,label:"Auto"},SMALL:{width:640,height:480,label:"640x480"},MEDIUM:{width:1280,height:720,label:"1280x720"},CUSTOM:{width:0,height:0,label:"Custom"}},w=function(){function e(){Object(c.a)(this,e),this.size=j.AUTO}return Object(s.a)(e,[{key:"exportDiaplaMediaConstraints",value:function(){return{video:this._size===j.AUTO||{width:this._size.width,height:this._size.height},audio:this._audio&&{channels:2,autoGainControl:!1,echoCancellation:this._echoCancellation,noiseSuppression:this._noiseSuppression},grabMic:this._grabMic}}},{key:"size",get:function(){return this._size},set:function(e){this._size=e}},{key:"height",set:function(e){this._size.height=e}},{key:"width",set:function(e){this._size.width=e}},{key:"audio",get:function(){return this._audio},set:function(e){this._audio=e}},{key:"echoCancellation",get:function(){return this._echoCancellation},set:function(e){this._echoCancellation=e}},{key:"noiseSuppression",get:function(){return this._noiseSuppression},set:function(e){this._noiseSuppression=e}},{key:"grabMic",get:function(){return this._grabMic},set:function(e){this._grabMic=e}}]),e}(),C=n(172),y=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.isChecked,r=t.label;return a.a.createElement(C.a.Checkbox,{label:r,checked:!!n,onChange:function(){return e.props.onChange(!n)}})}}]),n}(a.a.Component),k=n(170),S=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getRadioButtonsGroup",value:function(e,t,n,r){return Object.keys(t).map((function(o){var i=t[o],c=i[n];return a.a.createElement(C.a.Field,{control:k.a,key:c+"_radio",onChange:function(){return r(i)},value:c,checked:e===i,label:c})}))}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.values,r=e.labelField,a=e.onChange;return this.getRadioButtonsGroup(t,n,r,a)}}]),n}(a.a.Component),R=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).onFieldChange=function(t){var n=Object.assign(new w,e.props.constraints,t);e.props.onConstraintsChange(Object.assign({},{constraints:n}))},e}return Object(s.a)(n,[{key:"getCustomSizeInputs",value:function(e){var t=this;return a.a.createElement(C.a.Group,{inline:!0},a.a.createElement(C.a.Input,{onChange:function(e){return t.onFieldChange({width:+e.target.value})},value:e.size.width,type:"number",label:"Width",required:!0}),a.a.createElement(C.a.Input,{onChange:function(e){return t.onFieldChange({height:+e.target.value})},value:e.size.height,type:"number",label:"Height",required:!0}))}},{key:"render",value:function(){var e=this,t=this.props.constraints;return a.a.createElement(C.a,null,a.a.createElement(C.a.Group,{inline:!0},a.a.createElement(S,{onChange:function(t){return e.onFieldChange({size:t})},value:t.size,values:j,labelField:"label"}),t.size===j.CUSTOM&&this.getCustomSizeInputs(t)),a.a.createElement(C.a.Group,{inline:!0},a.a.createElement(y,{onChange:function(t){return e.onFieldChange({grabMic:t})},isChecked:t.grabMic,label:"Grab mic"}),a.a.createElement(y,{onChange:function(t){return e.onFieldChange({audio:t})},isChecked:t.audio,label:"Grab audio"}),t.audio&&a.a.createElement(y,{onChange:function(t){return e.onFieldChange({noiseSuppression:t})},isChecked:t.noiseSuppression,label:"Noise Suppression"}),t.audio&&a.a.createElement(y,{onChange:function(t){return e.onFieldChange({echoCancellation:t})},isChecked:t.echoCancellation,label:"Echo Cancellation"})))}}]),n}(a.a.Component),_=function(){function e(t){Object(c.a)(this,e),this._stream=t}return Object(s.a)(e,[{key:"start",value:function(){var e=this;this._rec=new MediaRecorder(this._stream),this._data=[],this._rec.ondataavailable=function(t){e._data.push(t.data)},this._rec.start()}},{key:"stop",value:function(){var e=this,t=new Promise((function(t,n){e._rec.onstop=t,e._rec.onerror=n}));return this._rec.stop(),this._stream.getTracks().forEach((function(e){return e.stop()})),t.then((function(){return new Blob(e._data,{type:"video/webm"})}))}},{key:"data",get:function(){return this._data}}]),e}();function U(e){var t=e.headers||{};return t.jwt_token=h.getFromStorage(p),Object.assign(e,{headers:t})}function x(){return(x=Object(g.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(v+"/records",U({method:"GET"}));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,console.log(n),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(g.a)(f.a.mark((function e(t){var n,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),e.next=4,fetch(v+"/records",U({method:"post",body:n}));case 4:return r=e.sent,e.next=7,r.text();case 7:return a=e.sent,console.log(a),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=n(171),T=n(178),P=n(179),z=n(173),D=function(e,t){var n=document.createElement("a");n.download=t,n.href=e,n.click()},L=n(174),G=n(75),I=(a.a.Component,function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).uploadingOn=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.setState(Object.assign({},r.state,{uploading:!0}));case 1:case"end":return e.stop()}}),e)}))),r.uploadingOff=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.setState(Object.assign({},r.state,{uploading:!1}));case 1:case"end":return e.stop()}}),e)}))),r.upload=function(){r.uploadingOn().then((function(){return function(e){return F.apply(this,arguments)}(new File([r.props.currentRecord],r.state.filename+".webm")).then(r.props.onNewFileUpload)})).finally(r.uploadingOff)},r.handleFilenameChange=function(e){r.setState(Object.assign({},r.state,{filename:e.target.value}))},r.state={filename:"my_recording_1",uploading:!1},r}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props,t=e.isRecording,n=e.currentRecordUrl,r=e.startRecording,o=e.stopRecording,i=this.state.filename;return a.a.createElement(C.a.Group,null,a.a.createElement(C.a.Button,{onClick:r},"Record"),a.a.createElement(C.a.Button,{onClick:o,disabled:!t},"Stop"),a.a.createElement("div",null,a.a.createElement(C.a.Input,{onChange:this.handleFilenameChange,value:i,label:"File name",required:!0}),a.a.createElement(L.a.Group,null,a.a.createElement(C.a.Button,{icon:"download",id:"downloadRecord",onClick:function(){return D(n,i)},disabled:!n||!i},"Download"),a.a.createElement(L.a.Or,{text:"or"}),a.a.createElement(C.a.Button,{onClick:this.upload,target:"_blank",disabled:!n||!i||"true",loading:this.state.uploading},"Upload"))))}}]),n}(a.a.Component)),N=n(177),B=n(176),A=n(106),J=n.n(A),q=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).videoElem=a.a.createRef(),r}return Object(s.a)(n,[{key:"shouldComponentUpdate",value:function(e,t,n){return!J()(e,this.props)}},{key:"componentDidMount",value:function(){var e=this.props.videoSourceProps,t=e.recordUrl,n=e.lastRec,r=e.record;this.videoElem.current.srcObject=null,this.videoElem.current.src="",t?this.videoElem.current.src=t:n?this.videoElem.current.src=window.URL.createObjectURL(r):this.videoElem.current.srcObject=this.props.mediaStream}},{key:"componentDidUpdate",value:function(e,t){if(!J()(e.videoSourceProps,this.props.videoSourceProps)){var n=this.props.videoSourceProps,r=n.recordUrl,a=n.lastRec,o=n.record;this.videoElem.current.srcObject=null,this.videoElem.current.src="",r?this.videoElem.current.src=r:a?this.videoElem.current.src=window.URL.createObjectURL(o):this.videoElem.current.srcObject=this.props.mediaStream}if(!J()(e.playerProps.videoSourceProps,this.props.playerProps)){var i=this.props.playerProps,c=i.play,s=i.pause,u=i.stop,l=i.muted;c&&this.videoElem.current.play(),s&&this.videoElem.current.pause(),u&&(this.videoElem.current.pause(),this.videoElem.current.currentTime=0),this.videoElem.current.muted=l}!function(e){if(e.srcObject){var t=e.srcObject.getVideoTracks()[0];console.debug("Track settings:"),console.debug(JSON.stringify(t.getSettings(),null,2)),console.debug("Track constraints:"),console.debug(JSON.stringify(t.getConstraints(),null,2));var n=e.srcObject.getAudioTracks()[0];n&&(console.debug("Track settings:"),console.debug(JSON.stringify(n.getSettings(),null,2)),console.debug("Track constraints:"),console.debug(JSON.stringify(n.getConstraints(),null,2)))}}(this.videoElem.current)}},{key:"render",value:function(){return a.a.createElement("video",{id:"video",loop:!0,ref:this.videoElem,title:"main vid"})}}]),n}(a.a.Component),W=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).play=function(e){e.preventDefault(),r.setState(Object.assign({},r.state,{play:!0,pause:!1,stop:!1}))},r.pause=function(e){e.preventDefault(),r.setState(Object.assign({},r.state,{play:!1,pause:!0,stop:!1}))},r.stop=function(e){e.preventDefault(),r.setState(Object.assign({},r.state,{play:!1,pause:!1,stop:!0}))},r.toggleMuted=function(e){e.preventDefault(),r.setState(Object.assign({},r.state,{muted:!r.state.muted}))},r.state={play:!1,pause:!1,stop:!0,muted:!1},r}return Object(s.a)(n,[{key:"getPlaceholder",value:function(e,t){return"Recording"===e?a.a.createElement(N.a,{icon:!0},a.a.createElement(G.a,{name:"record",color:"red"}),"Recording"):e>0&&e<=3?a.a.createElement(B.a,null,a.a.createElement(B.a.Value,null,e)):t?a.a.createElement(N.a,{icon:!0},a.a.createElement(G.a,{name:"file video",color:"grey"})):void 0}},{key:"render",value:function(){var e=this.props,t=e.videoSourceProps,n=e.placeholder,r=this.state,o=r.play,i=r.pause,c=r.stop,s=r.muted,u=!Object.values(t).find((function(e){return null!==e})),l=a.a.createElement(q,{videoSourceProps:t,playerProps:Object.assign({},this.state)});return a.a.createElement("div",null,a.a.createElement(T.a,{placeholder:!0},(u||n)&&this.getPlaceholder(n,u),!u&&!n&&l),a.a.createElement(T.a,null,a.a.createElement(L.a,{icon:!0,onClick:this.play,disabled:u||o},a.a.createElement(G.a,{name:"play",color:"green"})),a.a.createElement(L.a,{icon:!0,onClick:this.pause,disabled:u||i||c},a.a.createElement(G.a,{name:"pause",color:"grey"})),a.a.createElement(L.a,{icon:!0,onClick:this.stop,disabled:u||c},a.a.createElement(G.a,{name:"stop",color:"grey"})),a.a.createElement(L.a,{icon:!0,onClick:this.toggleMuted},s?a.a.createElement(G.a,{name:"volume off",color:"grey"}):a.a.createElement(G.a,{name:"volume up",color:"grey"}))))}}]),n}(a.a.Component),H=function(e){return new Promise((function(t){return setTimeout(t,e)}))},V=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this,e)).loadFileList=function(){(function(){return x.apply(this,arguments)})().then((function(e){r.setState(Object.assign({},r.state,{files:e}))}))},r.stopRecording=function(){r.state.recorder&&r.state.recorder.stop().then((function(e){var t=URL.createObjectURL(e),n=r.state.files.concat({name:"video"+r.state.files.length,url:t});r.setState(Object.assign({},r.state,{mediaStream:null,recorder:null,currentRecord:e,currentRecordUrl:t,files:n}))}))},r.countdown=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1e3,e.abrupt("return",H(1).then((function(){return r.setState(Object.assign({},r.state,{countdown:3}))})).then((function(){return H(1e3)})).then((function(){return r.setState(Object.assign({},r.state,{countdown:2}))})).then((function(){return H(1e3)})).then((function(){return r.setState(Object.assign({},r.state,{countdown:1}))})).then((function(){return H(1e3)})).then((function(){return r.setState(Object.assign({},r.state,{countdown:0}))})));case 2:case"end":return e.stop()}}),e)}))),r.startRecording=Object(g.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(r.state.constraints);case 2:(t=e.sent)&&(n=new _(t),r.countdown().then((function(){n.start(),r.setState(Object.assign({},r.state,{mediaStream:t,recorder:n,currentRecord:null,currentRecordUrl:null}))})));case 4:case"end":return e.stop()}}),e)}))),r.onHitPlay=function(e){r.setState({mediaStream:null,constraints:new w,recorder:null,currentRecord:e,currentRecordUrl:e.url,files:r.state.files})},r.onConstraintsChange=function(e){r.setState(Object.assign({},r.state,e))},r.onNewFileUpload=function(){r.loadFileList()},r.state={mediaStream:null,constraints:new w,recorder:null,currentRecord:null,currentRecordUrl:null,files:[],countdown:0},r}return Object(s.a)(n,[{key:"componentDidMount",value:function(){0}},{key:"render",value:function(){var e,t=this.state,n=t.mediaStream,r=t.currentRecord,o=t.currentRecordUrl,i=t.constraints,c=(t.files,t.countdown),s=t.recorder;return c>0?e=c:s&&(e="Recording"),a.a.createElement(M.a,null,a.a.createElement(T.a,null,a.a.createElement(P.a,{divided:"vertically",stretched:!0},a.a.createElement(P.a.Row,{columns:1},a.a.createElement(P.a.Column,{width:0},a.a.createElement(W,{videoSourceProps:{mediaStream:n,record:r,recordUrl:o},placeholder:e}),a.a.createElement(T.a,null,a.a.createElement(C.a,null,a.a.createElement(R,{onConstraintsChange:this.onConstraintsChange,constraints:i}),a.a.createElement(I,{isRecording:!!n,currentRecord:r,currentRecordUrl:o,stopRecording:this.stopRecording,startRecording:this.startRecording,onNewFileUpload:this.onNewFileUpload})))),!1))))}}]),n}(a.a.Component),K=n(123),$=n.n(K),Q=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;Object(c.a)(this,n),r=t.call(this,e);var a=!!h.getFromStorage(p);return r.state={loginSuccess:a},r.onLoginUpdate=r.onLoginUpdate.bind(Object(u.a)(r)),r}return Object(s.a)(n,[{key:"onLoginUpdate",value:function(){var e=!!h.getFromStorage(p);this.setState(Object.assign({},{loginSuccess:e}))}},{key:"render",value:function(){this.state.loginSuccess;return a.a.createElement(M.a,null,a.a.createElement($.a,{href:"https://github.com/league55/RTC-screen-record",bannerColor:"#70B7FD"}),a.a.createElement(V,null))}}]),n}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(154).config(),i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[137,1,2]]]);
//# sourceMappingURL=main.762175fc.chunk.js.map